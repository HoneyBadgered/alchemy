generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model achievements {
  id                String              @id
  name              String              @unique
  description       String
  iconUrl           String?
  category          String
  triggerType       String
  triggerValue      Int
  xpReward          Int                 @default(0)
  pointsReward      Int                 @default(0)
  isActive          Boolean             @default(true)
  isSecret          Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  user_achievements user_achievements[]
}

model addresses {
  id           String   @id
  userId       String
  label        String?
  firstName    String
  lastName     String
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  zipCode      String
  country      String
  phone        String?
  isDefault    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model bundle_items {
  id              String          @id
  bundleId        String
  productId       String
  quantity        Int             @default(1)
  product_bundles product_bundles @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  products        products        @relation(fields: [productId], references: [id])

  @@unique([bundleId, productId])
}

model cart_items {
  id        String   @id
  cartId    String
  productId String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime
  carts     carts    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  products  products @relation(fields: [productId], references: [id])

  @@unique([cartId, productId])
}

model carts {
  id         String       @id
  userId     String?      @unique
  sessionId  String?      @unique
  createdAt  DateTime     @default(now())
  updatedAt  DateTime
  cart_items cart_items[]
  users      users?       @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model discount_codes {
  id             String    @id
  code           String    @unique
  description    String?
  discountType   String
  discountValue  Decimal   @db.Decimal(10, 2)
  minOrderAmount Decimal?  @db.Decimal(10, 2)
  maxUses        Int?
  usedCount      Int       @default(0)
  validFrom      DateTime
  validUntil     DateTime?
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
}

model email_templates {
  id        String   @id
  name      String   @unique
  subject   String
  bodyHtml  String
  bodyText  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model events {
  id          String    @id
  eventType   String
  userId      String?
  payload     Json
  processedAt DateTime?
  createdAt   DateTime  @default(now())

  @@index([createdAt])
  @@index([eventType])
  @@index([userId])
}

model ingredient_pairings {
  id                                                              String      @id
  sourceIngredientId                                              String
  targetIngredientId                                              String
  createdAt                                                       DateTime    @default(now())
  ingredients_ingredient_pairings_sourceIngredientIdToingredients ingredients @relation("ingredient_pairings_sourceIngredientIdToingredients", fields: [sourceIngredientId], references: [id], onDelete: Cascade)
  ingredients_ingredient_pairings_targetIngredientIdToingredients ingredients @relation("ingredient_pairings_targetIngredientIdToingredients", fields: [targetIngredientId], references: [id], onDelete: Cascade)

  @@unique([sourceIngredientId, targetIngredientId])
}

model ingredients {
  id                                                                      String                @id
  name                                                                    String
  role                                                                    String                @default("addIn")
  category                                                                String
  descriptionShort                                                        String?
  descriptionLong                                                         String?
  image                                                                   String?
  flavorNotes                                                             String[]              @default([])
  cutOrGrade                                                              String?
  recommendedUsageMin                                                     Decimal?              @db.Decimal(10, 4)
  recommendedUsageMax                                                     Decimal?              @db.Decimal(10, 4)
  steepTemperature                                                        Int?
  steepTimeMin                                                            Int?
  steepTimeMax                                                            Int?
  brewNotes                                                               String?
  supplierId                                                              String?
  costPerOunce                                                            Decimal?              @db.Decimal(10, 4)
  costPerGram                                                             Decimal?              @db.Decimal(10, 4)
  inventoryAmount                                                         Decimal               @default(0) @db.Decimal(10, 2)
  minimumStockLevel                                                       Decimal               @default(0) @db.Decimal(10, 2)
  status                                                                  String                @default("active")
  caffeineLevel                                                           String                @default("none")
  allergens                                                               String[]              @default([])
  internalNotes                                                           String?
  emoji                                                                   String?
  tags                                                                    String[]              @default([])
  badges                                                                  String[]              @default([])
  isBase                                                                  Boolean               @default(false)
  baseAmount                                                              Decimal?              @db.Decimal(10, 2)
  incrementAmount                                                         Decimal?              @db.Decimal(10, 2)
  createdAt                                                               DateTime              @default(now())
  updatedAt                                                               DateTime
  ingredient_pairings_ingredient_pairings_sourceIngredientIdToingredients ingredient_pairings[] @relation("ingredient_pairings_sourceIngredientIdToingredients")
  ingredient_pairings_ingredient_pairings_targetIngredientIdToingredients ingredient_pairings[] @relation("ingredient_pairings_targetIngredientIdToingredients")
  suppliers                                                               suppliers?            @relation(fields: [supplierId], references: [id])

  @@index([category])
  @@index([status])
  @@index([supplierId])
}

model label_designs {
  id            String   @id
  orderId       String
  name          String
  tagline       String
  description   String
  stylePreset   String?
  tonePreset    String?
  artworkPrompt String?
  artworkUrl    String?
  status        String   @default("draft")
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  orders        orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)
}

model notification_preferences {
  id               String   @id
  userId           String   @unique
  emailEnabled     Boolean  @default(true)
  smsEnabled       Boolean  @default(false)
  marketingEnabled Boolean  @default(true)
  orderUpdates     Boolean  @default(true)
  backInStock      Boolean  @default(true)
  announcements    Boolean  @default(true)
  weeklyDigest     Boolean  @default(false)
  phoneNumber      String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model order_items {
  id        String   @id
  orderId   String
  productId String
  quantity  Int      @default(1)
  price     Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now())
  orders    orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  products  products @relation(fields: [productId], references: [id])
}

model order_status_logs {
  id         String   @id
  orderId    String
  fromStatus String?
  toStatus   String
  changedBy  String?
  notes      String?
  createdAt  DateTime @default(now())
  users      users?   @relation(fields: [changedBy], references: [id])
  orders     orders   @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([changedBy])
  @@index([orderId])
}

model orders {
  id                  String              @id
  userId              String?
  status              String              @default("pending")
  totalAmount         Decimal             @db.Decimal(10, 2)
  shippingMethod      String?
  shippingCost        Decimal?            @db.Decimal(10, 2)
  taxAmount           Decimal?            @db.Decimal(10, 2)
  discountCode        String?
  discountAmount      Decimal?            @db.Decimal(10, 2)
  customerNotes       String?
  stripePaymentId     String?             @unique
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  stripePaymentStatus String?
  stripeClientSecret  String?
  guestEmail          String?
  sessionId           String?
  label_designs       label_designs[]
  order_items         order_items[]
  order_status_logs   order_status_logs[]
  users               users?              @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model payment_methods {
  id               String   @id
  userId           String
  stripePaymentId  String   @unique
  type             String
  last4            String
  brand            String?
  expirationMonth  Int?
  expirationYear   Int?
  isDefault        Boolean  @default(false)
  billingAddressId String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model player_cosmetics {
  id                String   @id
  userId            String   @unique
  unlockedThemes    String[]
  unlockedSkins     String[]
  activeThemeId     String?
  activeTableSkinId String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model player_inventory {
  id        String   @id
  userId    String
  itemId    String
  itemType  String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, itemId])
}

model player_quests {
  id          String    @id
  userId      String
  questId     String
  status      String    @default("active")
  progress    Int       @default(0)
  startedAt   DateTime  @default(now())
  completedAt DateTime?
  claimedAt   DateTime?
  quests      quests    @relation(fields: [questId], references: [id], onDelete: Cascade)
  users       users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, questId])
}

model player_states {
  id                String    @id
  userId            String    @unique
  level             Int       @default(1)
  xp                Int       @default(0)
  totalXp           Int       @default(0)
  currentStreak     Int       @default(0)
  longestStreak     Int       @default(0)
  lastLoginAt       DateTime  @default(now())
  lastDailyRewardAt DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  users             users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model product_bundles {
  id           String         @id
  name         String
  description  String?
  discount     Decimal        @db.Decimal(5, 2)
  isActive     Boolean        @default(true)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime
  bundle_items bundle_items[]
}

model product_relations {
  id                                                    String   @id
  sourceProductId                                       String
  relatedProductId                                      String
  relationType                                          String
  sortOrder                                             Int      @default(0)
  createdAt                                             DateTime @default(now())
  products_product_relations_relatedProductIdToproducts products @relation("product_relations_relatedProductIdToproducts", fields: [relatedProductId], references: [id], onDelete: Cascade)
  products_product_relations_sourceProductIdToproducts  products @relation("product_relations_sourceProductIdToproducts", fields: [sourceProductId], references: [id], onDelete: Cascade)

  @@unique([sourceProductId, relatedProductId])
  @@index([sourceProductId])
}

model products {
  id                                                             String              @id
  name                                                           String
  description                                                    String
  price                                                          Decimal             @db.Decimal(10, 2)
  imageUrl                                                       String?
  category                                                       String?
  isActive                                                       Boolean             @default(true)
  stock                                                          Int                 @default(0)
  createdAt                                                      DateTime            @default(now())
  updatedAt                                                      DateTime
  images                                                         String[]            @default([])
  tags                                                           String[]            @default([])
  compareAtPrice                                                 Decimal?            @db.Decimal(10, 2)
  lowStockThreshold                                              Int                 @default(5)
  trackInventory                                                 Boolean             @default(true)
  averageRating                                                  Decimal?            @db.Decimal(2, 1)
  reviewCount                                                    Int                 @default(0)
  bundle_items                                                   bundle_items[]
  cart_items                                                     cart_items[]
  order_items                                                    order_items[]
  product_relations_product_relations_relatedProductIdToproducts product_relations[] @relation("product_relations_relatedProductIdToproducts")
  product_relations_product_relations_sourceProductIdToproducts  product_relations[] @relation("product_relations_sourceProductIdToproducts")
  reviews                                                        reviews[]
  wishlist_items                                                 wishlist_items[]
}

model quests {
  id                String          @id
  name              String
  description       String
  questType         String
  requiredLevel     Int             @default(1)
  xpReward          Int             @default(0)
  ingredientRewards Json?
  cosmeticRewards   Json?
  isActive          Boolean         @default(true)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  player_quests     player_quests[]
}

model recipes {
  id            String   @id
  name          String
  description   String?
  requiredLevel Int      @default(1)
  ingredients   Json
  resultItemId  String
  xpGained      Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model refresh_tokens {
  id        String   @id
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model reviews {
  id         String   @id
  userId     String
  productId  String
  rating     Int
  title      String?
  content    String?
  isVerified Boolean  @default(false)
  isApproved Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  products   products @relation(fields: [productId], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
}

model reward_history {
  id          String   @id
  userId      String
  type        String
  points      Int
  description String
  orderId     String?
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model reward_points {
  id             String   @id
  userId         String   @unique
  balance        Int      @default(0)
  lifetimeEarned Int      @default(0)
  tier           String   @default("Novice")
  tierUpdatedAt  DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model rewards {
  id            String   @id
  name          String
  description   String?
  pointsCost    Int
  discountType  String?
  discountValue Decimal? @db.Decimal(10, 2)
  productId     String?
  minimumTier   String   @default("Novice")
  isActive      Boolean  @default(true)
  stock         Int?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model shipping_methods {
  id            String   @id
  name          String   @unique
  description   String?
  price         Decimal  @db.Decimal(10, 2)
  estimatedDays String?
  isActive      Boolean  @default(true)
  sortOrder     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model site_settings {
  id          String   @id
  key         String   @unique
  value       String
  description String?
  category    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model stripe_webhook_events {
  id          String    @id
  eventId     String    @unique
  eventType   String
  payload     Json
  processed   Boolean   @default(false)
  processedAt DateTime?
  error       String?
  createdAt   DateTime  @default(now())

  @@index([eventType])
  @@index([processed])
}

model subscriptions {
  id                   String    @id
  userId               String
  productId            String
  name                 String
  frequency            String
  quantity             Int       @default(1)
  price                Decimal   @db.Decimal(10, 2)
  status               String    @default("active")
  nextShipmentDate     DateTime?
  lastShipmentDate     DateTime?
  pausedAt             DateTime?
  cancelledAt          DateTime?
  skipNextShipment     Boolean   @default(false)
  stripeSubscriptionId String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  users                users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}

model suppliers {
  id          String        @id
  name        String
  email       String?
  phone       String?
  website     String?
  address     String?
  notes       String?
  isActive    Boolean       @default(true)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  ingredients ingredients[]
}

model table_skins {
  id              String   @id
  name            String   @unique
  description     String?
  themeId         String
  imageUrl        String?
  requiredLevel   Int      @default(1)
  requiredQuestId String?
  isPremium       Boolean  @default(false)
  price           Decimal? @db.Decimal(10, 2)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  themes          themes   @relation(fields: [themeId], references: [id], onDelete: Cascade)
}

model tax_rates {
  id        String   @id
  name      String
  region    String   @unique
  rate      Decimal  @db.Decimal(5, 4)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model themes {
  id              String        @id
  name            String        @unique
  description     String?
  backgroundUrl   String?
  colorPalette    Json?
  requiredLevel   Int           @default(1)
  requiredQuestId String?
  isPremium       Boolean       @default(false)
  price           Decimal?      @db.Decimal(10, 2)
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  table_skins     table_skins[]
}

model user_achievements {
  id            String       @id
  userId        String
  achievementId String
  earnedAt      DateTime?
  progress      Int          @default(0)
  achievements  achievements @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  users         users        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
}

model user_profiles {
  id                 String   @id
  userId             String   @unique
  firstName          String?
  lastName           String?
  avatarUrl          String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  allergyNotes       String?
  caffeinePreference String?
  flavorPreferences  String[] @default([])
  users              users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                       String                    @id
  email                    String                    @unique
  password                 String
  username                 String                    @unique
  role                     String                    @default("user")
  emailVerified            Boolean                   @default(false)
  emailVerificationToken   String?
  emailVerificationExpires DateTime?
  passwordResetToken       String?
  passwordResetExpires     DateTime?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  addresses                addresses[]
  carts                    carts?
  notification_preferences notification_preferences?
  order_status_logs        order_status_logs[]
  orders                   orders[]
  payment_methods          payment_methods[]
  player_cosmetics         player_cosmetics?
  player_inventory         player_inventory[]
  player_quests            player_quests[]
  player_states            player_states?
  refresh_tokens           refresh_tokens[]
  reviews                  reviews[]
  reward_history           reward_history[]
  reward_points            reward_points?
  subscriptions            subscriptions[]
  user_achievements        user_achievements[]
  user_profiles            user_profiles?
  wishlist_items           wishlist_items[]
}

model wishlist_items {
  id        String   @id
  userId    String
  productId String
  createdAt DateTime @default(now())
  products  products @relation(fields: [productId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
}
